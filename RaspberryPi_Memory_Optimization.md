# Raspberry Pi向けメモリ最適化ガイド

## 導入済みの最適化

### 1. JVM設定
以下の環境変数設定をRaspberry Piの起動スクリプトに追加することを推奨します：

```bash
export JAVA_OPTS="-Xms128m -Xmx256m -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
```

この設定は：
- 最小ヒープサイズを128MB、最大ヒープサイズを256MBに設定
- G1GCガベージコレクタを使用し、GCの一時停止を制限

### 2. Spring Bootの最適化

application.yamlには以下の最適化が施されています：

- Hibernateのバッチサイズとキャッシュ設定の最適化
- Thymeleafのキャッシュを有効化
- 静的リソースのキャッシュ期間を設定
- JMXエンドポイントの無効化
- Tomcatのスレッド数と接続数の制限
- ロギングレベルの調整

### 3. アーキテクチャの最適化

- 非同期処理のスレッドプールサイズを最小化
- 頻繁にアクセスされる商品データにインメモリキャッシュを導入
- メモリ使用状況のモニタリングコンポーネント（開発環境用）

## さらなる最適化の提案

1. **静的リソースの最適化**：
   - 画像を適切なサイズと形式に最適化
   - CSS/JSファイルを最小化

2. **JVMチューニング**：
   - `-XX:+UseStringDeduplication`を追加してString重複を削減
   - JITコンパイラ設定を調整（必要に応じて）

3. **データベース最適化**：
   - インデックスを適切に設計・管理
   - 大きなデータセットの取得時にページング処理を導入

4. **起動時間の短縮**：
   - Spring Boot Lazy Initializationの導入検討

5. **運用上の考慮事項**：
   - 定期的なヒープダンプ分析
   - SQLiteデータベースの定期的な最適化（VACUUM）

## メモリモニタリング

`MemoryMonitor`クラスを使って、開発環境でのメモリ使用状況を監視できます。
本番環境では、外部モニタリングツールの使用も検討してください。
